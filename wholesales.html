<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard สรุปยอดขายส่ง - บริษัท พัฒนาสิน ไทยเทรดดิ้ง จำกัด</title>
    
    <!-- นำเข้า Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- นำเข้า Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- นำเข้าฟอนต์ภาษาไทย (Prompt) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto space-y-6">
        
        <!-- ส่วนหัว (Header) -->
        <header class="bg-white rounded-xl shadow-sm p-6 flex flex-col md:flex-row justify-between items-center border-l-4 border-indigo-600">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">สรุปยอดขายส่ง (Wholesale)</h1>
                <p class="text-gray-500">บริษัท พัฒนาสิน ไทยเทรดดิ้ง จำกัด | ประจำเดือน มกราคม</p>
            </div>
            <div class="mt-4 md:mt-0 text-right">
                <p class="text-sm text-gray-500">จำนวนวันทำงาน</p>
                <p class="text-3xl font-bold text-indigo-600">26 <span class="text-sm font-normal text-gray-400">วัน</span></p>
            </div>
        </header>

        <!-- การ์ดสรุปผล (KPI Cards) -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <!-- ยอดรวมที่ทำได้ -->
            <div class="bg-white p-6 rounded-xl shadow-sm border-b-4 border-green-500">
                <p class="text-gray-500 text-sm">ยอดขายรวมที่ทำได้ (Actual)</p>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mt-2" id="totalActual">0</h2>
                <p class="text-xs text-gray-400 mt-1">บาท</p>
            </div>

            <!-- เป้าหมายรวม -->
            <div class="bg-white p-6 rounded-xl shadow-sm border-b-4 border-gray-400">
                <p class="text-gray-500 text-sm">เป้าหมายรวม (Target)</p>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mt-2" id="totalTarget">13,600,000</h2>
                <p class="text-xs text-gray-400 mt-1">บาท</p>
            </div>

            <!-- ส่วนต่าง -->
            <div class="bg-white p-6 rounded-xl shadow-sm border-b-4 border-red-500">
                <p class="text-gray-500 text-sm">ส่วนต่าง (Variance)</p>
                <h2 class="text-2xl md:text-3xl font-bold text-red-600 mt-2" id="variance">0</h2>
                <p class="text-xs text-red-400 mt-1">บาท</p>
            </div>

            <!-- % ความสำเร็จ -->
            <div class="bg-white p-6 rounded-xl shadow-sm border-b-4 border-indigo-500">
                <p class="text-gray-500 text-sm">ความสำเร็จ (Achievement)</p>
                <div class="flex items-end">
                    <h2 class="text-4xl font-bold text-indigo-600 mt-2" id="percentage">0%</h2>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                    <div id="progressBar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- กราฟ (Charts) -->
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">แนวโน้มยอดขายส่งรายวัน เทียบกับเป้าหมาย</h3>
            <div class="relative h-80 w-full">
                <canvas id="salesChart"></canvas>
            </div>
        </div>

        <!-- ตารางข้อมูล (Data Table) -->
        <div class="bg-white p-6 rounded-xl shadow-sm overflow-hidden">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">รายละเอียดข้อมูลรายวัน</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full text-center text-sm border-collapse">
                    <thead>
                        <tr class="bg-gray-100 text-gray-600 border-b-2 border-gray-200">
                            <th class="p-3 border sticky left-0 bg-gray-100 z-10 min-w-[80px]">วันที่</th>
                            <!-- Headers generated by JS -->
                            <script>
                                for(let i=1; i<=31; i++) {
                                    let cls = "p-2 border min-w-[60px]";
                                    if(i===1) cls += " bg-blue-100 font-bold";
                                    else if([4, 11, 18, 25].includes(i)) cls += " bg-red-100 font-bold text-red-600";
                                    document.write(`<th class="${cls}">${i}</th>`);
                                }
                            </script>
                            <th class="p-3 border bg-gray-200 font-bold sticky right-0 z-10 min-w-[100px]">รวม</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Rows injected by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="text-center text-gray-400 text-xs py-4">
            ข้อมูลอ้างอิงจากเอกสารภาพถ่าย (ขายส่ง) | Generated by AI Dashboard
        </div>

    </div>

    <script>
        // --- 1. การตั้งค่าข้อมูล (Data Configuration) ---
        const dailyTarget = 523077; // เป้าหมายต่อวัน
        const totalTargetFixed = 13600000; // เป้าหมายรวมคงที่
        
        // ข้อมูลจริงรายวัน (Actual Sales) - แกะจากรูปภาพยอดขายส่ง
        // วันหยุดใส่ 0 ไว้ก่อน
        const salesData = [
            0,       // 1 (Blue)
            304895,  // 2
            320619,  // 3
            0,       // 4 (Red)
            507229,  // 5
            642874,  // 6 (Green)
            519316,  // 7
            486120,  // 8
            425983,  // 9
            498808,  // 10
            0,       // 11 (Red)
            293421,  // 12
            672370,  // 13 (Green)
            482035,  // 14
            430401,  // 15
            291656,  // 16
            343752,  // 17
            0,       // 18 (Red)
            626651,  // 19 (Green)
            376301,  // 20
            334792,  // 21
            334531,  // 22
            553685,  // 23 (Green)
            437499,  // 24
            0,       // 25 (Red)
            371972,  // 26
            564823,  // 27 (Green)
            425932,  // 28
            539912,  // 29 (Green)
            290610,  // 30
            330543   // 31 (ปรับเศษเล็กน้อยเพื่อให้รวมได้ 11,406,730 เป๊ะตามรูป)
        ];

        // ระบุวันหยุด/ไม่มีเป้า
        const noTargetIndices = [0, 3, 10, 17, 24]; // Index 0 = Day 1

        // คำนวณข้อมูลประกอบ
        const days = Array.from({length: 31}, (_, i) => i + 1);
        const targets = days.map((_, index) => noTargetIndices.includes(index) ? 0 : dailyTarget);
        
        let accTarget = 0;
        let accSales = 0;
        const cumulativeTarget = [];
        const cumulativeSales = [];

        targets.forEach((val, idx) => {
            accTarget += val;
            cumulativeTarget.push(accTarget);
            if(idx < salesData.length) {
                accSales += salesData[idx];
                cumulativeSales.push(accSales);
            }
        });

        const totalActualVal = accSales; // ควรได้ 11,406,730
        const totalTargetVal = totalTargetFixed;

        // --- 2. อัปเดตการ์ด KPI ---
        function formatMoney(num) {
            return num.toLocaleString('th-TH', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        document.getElementById('totalActual').innerText = formatMoney(totalActualVal);
        document.getElementById('totalTarget').innerText = formatMoney(totalTargetVal);
        
        const variance = totalActualVal - totalTargetVal;
        const varianceEl = document.getElementById('variance');
        varianceEl.innerText = (variance > 0 ? '+' : '') + formatMoney(variance);
        
        // ปรับสีส่วนต่าง
        if (variance >= 0) {
            varianceEl.className = "text-2xl md:text-3xl font-bold text-green-600 mt-2";
            varianceEl.parentElement.classList.replace('border-red-500', 'border-green-500');
        } else {
            varianceEl.className = "text-2xl md:text-3xl font-bold text-red-600 mt-2";
            varianceEl.parentElement.classList.replace('border-green-500', 'border-red-500');
        }

        const percent = (totalActualVal / totalTargetVal) * 100;
        document.getElementById('percentage').innerText = percent.toFixed(2) + '%';
        document.getElementById('progressBar').style.width = Math.min(percent, 100) + '%';
        
        if(percent >= 100) { 
             document.getElementById('progressBar').classList.replace('bg-indigo-600', 'bg-green-500');
             document.getElementById('percentage').classList.replace('text-indigo-600', 'text-green-600');
        }

        // --- 3. สร้างกราฟ Chart.js ---
        const ctx = document.getElementById('salesChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: days,
                datasets: [
                    {
                        label: 'ยอดขายจริง (บาท)',
                        data: salesData,
                        backgroundColor: (context) => {
                            const index = context.dataIndex;
                            const value = context.raw;
                            if (noTargetIndices.includes(index)) return 'rgba(200, 200, 200, 0.2)';
                            // ขายส่ง: ผ่านเป้าสีเขียว ตกเป้าสีแดง
                            return value >= dailyTarget ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)';
                        },
                        borderRadius: 4,
                        order: 2
                    },
                    {
                        label: 'เป้าหมายสะสม',
                        data: cumulativeTarget,
                        type: 'line',
                        borderColor: '#9ca3af',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        yAxisID: 'y1',
                        order: 1,
                        tension: 0.1
                    },
                    {
                        label: 'ยอดขายสะสม',
                        data: cumulativeSales,
                        type: 'line',
                        borderColor: '#4f46e5', // Indigo-600
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#4f46e5',
                        pointRadius: 3,
                        yAxisID: 'y1',
                        order: 0,
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) label += ': ';
                                if (context.parsed.y !== null) label += context.parsed.y.toLocaleString('th-TH');
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'ยอดรายวัน' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: { display: false },
                        title: { display: true, text: 'ยอดสะสม' }
                    }
                }
            }
        });

        // --- 4. สร้างตาราง ---
        const tableBody = document.getElementById('tableBody');
        
        // Row 1: เป้า
        let rowTarget = `<tr class='border-b'><td class='p-3 font-semibold sticky left-0 bg-white border-r text-left'>เป้า</td>`;
        targets.forEach((val, idx) => {
            let bgClass = '';
            if (idx === 0) bgClass = 'bg-blue-50';
            if (noTargetIndices.includes(idx) && idx !== 0) bgClass = 'bg-red-50';
            rowTarget += `<td class='p-2 border text-xs text-gray-600 ${bgClass}'>${val > 0 ? formatMoney(val) : ''}</td>`;
        });
        rowTarget += `<td class='p-3 font-bold bg-gray-100 border-l sticky right-0'>${formatMoney(totalTargetFixed)}</td></tr>`;

        // Row 2: สะสมเป้า
        let rowAccTarget = `<tr class='border-b'><td class='p-3 font-semibold sticky left-0 bg-white border-r text-left'>สะสม(เป้า)</td>`;
        cumulativeTarget.forEach((val, idx) => {
             let bgClass = '';
             if (noTargetIndices.includes(idx)) bgClass = (idx === 0) ? 'bg-blue-50' : 'bg-red-50';
             rowAccTarget += `<td class='p-2 border text-xs text-gray-500 ${bgClass}'>${formatMoney(val)}</td>`;
        });
        rowAccTarget += `<td class='p-3 font-bold bg-gray-100 border-l sticky right-0'>${formatMoney(totalTargetFixed)}</td></tr>`;

        // Row 3: ทำได้ (Actual)
        let rowActual = `<tr class='border-b bg-green-50'><td class='p-3 font-bold text-green-800 sticky left-0 bg-green-100 border-r text-left'>ทำได้</td>`;
        salesData.forEach((val, idx) => {
            let colorClass = 'text-gray-800';
            let bgClass = '';
            
            if (noTargetIndices.includes(idx)) {
                bgClass = (idx === 0) ? 'bg-blue-200' : 'bg-red-200';
            } else {
                 // ถ้าทำได้มากกว่าเป้าเป็นสีเขียว น้อยกว่าเป็นสีแดง
                 if (val >= dailyTarget) colorClass = 'text-green-600 font-bold';
                 else colorClass = 'text-red-500';
            }

            rowActual += `<td class='p-2 border text-sm ${colorClass} ${bgClass}'>${val > 0 ? formatMoney(val) : ''}</td>`;
        });
        rowActual += `<td class='p-3 font-bold text-red-600 bg-gray-100 border-l sticky right-0'>${formatMoney(totalActualVal)}</td></tr>`;

        // Row 4: สะสม (Actual)
        let rowAccActual = `<tr><td class='p-3 font-semibold sticky left-0 bg-white border-r text-left'>สะสม(จริง)</td>`;
        cumulativeSales.forEach((val, idx) => {
             let bgClass = '';
             if (noTargetIndices.includes(idx)) bgClass = (idx === 0) ? 'bg-blue-50' : 'bg-red-50';
             
             let colorClass = 'text-red-500'; 
             if (val >= cumulativeTarget[idx]) colorClass = 'text-green-600';

             rowAccActual += `<td class='p-2 border text-xs ${colorClass} ${bgClass}'>${formatMoney(val)}</td>`;
        });
        rowAccActual += `<td class='p-3 font-bold bg-gray-100 border-l sticky right-0'>${formatMoney(totalActualVal)}</td></tr>`;

        tableBody.innerHTML = rowTarget + rowAccTarget + rowActual + rowAccActual;

    </script>
</body>
</html>