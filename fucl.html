<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายงานประสิทธิภาพการใช้เชื้อเพลิง (Fuel Efficiency Report)</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Prop-types (Required dependency for some UMD builds of Recharts) -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    
    <!-- Recharts -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.0/Recharts.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        /* Import Thai Font */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap');
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        // Ensure Recharts is loaded
        const RechartsObj = window.Recharts || window.Recharts.default;
        
        if (!RechartsObj) {
            document.getElementById('root').innerHTML = '<div class="p-10 text-red-600 font-bold">Error: Recharts library failed to load. Please check your internet connection.</div>';
            throw new Error("Recharts not found");
        }

        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = RechartsObj;

        // --- ICON COMPONENTS (SVG) ---
        const Truck = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M15 18H9"/><path d="M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14"/><circle cx="17" cy="18" r="2"/><circle cx="7" cy="18" r="2"/></svg>
        );
        const User = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        );
        const Fuel = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="3" x2="15" y1="22" y2="22"/><line x1="4" x2="14" y1="9" y2="9"/><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"/><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"/></svg>
        );
        const TrendingUp = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
        );
        const TrendingDown = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></svg>
        );
        const AlertCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
        );
        const CheckCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        );

        // --- DATA ---
        const data = [
            {
                id: 1,
                plate: "84-5551 อด",
                truckName: "บุญหนัก",
                driver: "วิชัย",
                fuelLiters: 344.49,
                fuelCost: 10572.60,
                distance: 2323.00,
                actualKmL: 6.74,
                targetKmL: 7.00,
                bahtPerKm: 4.55,
                status: "fail"
            },
            {
                id: 2,
                plate: "84-3178 อด",
                truckName: "ทำเงิน",
                driver: "บูรพา",
                fuelLiters: 406.81,
                fuelCost: 12470.00,
                distance: 2875.00,
                actualKmL: 7.07,
                targetKmL: 6.80,
                bahtPerKm: 4.34,
                status: "pass"
            },
            {
                id: 3,
                plate: "83-9195 อด",
                truckName: "พี่หมาน",
                driver: "ใย",
                fuelLiters: 500.65,
                fuelCost: 15430.00,
                distance: 4267.00,
                actualKmL: 8.52,
                targetKmL: 8.70,
                bahtPerKm: 3.62,
                status: "fail"
            },
            {
                id: 4,
                plate: "84-1902 อด",
                truckName: "นำโชค",
                driver: "เรืองยศ",
                fuelLiters: 617.21,
                fuelCost: 18990.00,
                distance: 5453.00,
                actualKmL: 8.83,
                targetKmL: 9.50,
                bahtPerKm: 3.48,
                status: "fail"
            },
            {
                id: 5,
                plate: "2ฒบ 2585 กทม.",
                truckName: "ออมสิน",
                driver: "ไม่ระบุ",
                fuelLiters: 395.37,
                fuelCost: 12110.00,
                distance: 4196.00,
                actualKmL: 10.61,
                targetKmL: 11.80,
                bahtPerKm: 2.89,
                status: "fail"
            }
        ];

        // --- COMPONENTS ---
        const SummaryCard = ({ title, value, subtext, icon: Icon, colorClass }) => (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex items-start justify-between">
                <div>
                    <p className="text-sm font-medium text-slate-500 mb-1">{title}</p>
                    <h3 className="text-2xl font-bold text-slate-800">{value}</h3>
                    <p className={`text-xs mt-2 ${colorClass}`}>{subtext}</p>
                </div>
                <div className={`p-3 rounded-lg ${colorClass.replace('text-', 'bg-').replace('600', '100')}`}>
                    <Icon className={`w-6 h-6 ${colorClass}`} />
                </div>
            </div>
        );

        const DriverCard = ({ item }) => {
            const diff = (item.actualKmL - item.targetKmL).toFixed(2);
            const isPass = item.actualKmL >= item.targetKmL;
            const percentageDiff = ((diff / item.targetKmL) * 100).toFixed(1);

            return (
                <div className={`bg-white rounded-xl shadow-sm border-l-4 p-5 transition-all hover:shadow-md ${isPass ? 'border-green-500' : 'border-red-500'}`}>
                    <div className="flex justify-between items-start mb-4">
                        <div className="flex items-center gap-3">
                            <div className="bg-blue-50 p-2 rounded-full">
                                <Truck className="w-6 h-6 text-blue-600" />
                            </div>
                            <div>
                                <h3 className="font-bold text-lg text-slate-800">{item.truckName}</h3>
                                <p className="text-sm text-slate-500">{item.plate}</p>
                            </div>
                        </div>
                        <div className="text-right">
                            <div className="flex items-center gap-2 justify-end">
                                <User className="w-4 h-4 text-slate-400" />
                                <span className="font-semibold text-slate-700">{item.driver || "-"}</span>
                            </div>
                            <span className={`text-xs px-2 py-1 rounded-full mt-1 inline-block font-medium ${isPass ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                {isPass ? 'ผ่านเกณฑ์' : 'ต่ำกว่าเกณฑ์'}
                            </span>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div className="bg-slate-50 p-3 rounded-lg">
                            <p className="text-xs text-slate-500 mb-1">ทำได้จริง (Jan-26)</p>
                            <p className={`text-xl font-bold ${isPass ? 'text-green-600' : 'text-red-600'}`}>
                                {item.actualKmL} <span className="text-xs text-slate-400">km/L</span>
                            </p>
                        </div>
                        <div className="bg-slate-50 p-3 rounded-lg border border-slate-100">
                            <p className="text-xs text-slate-500 mb-1">เป้าหมาย (Target)</p>
                            <p className="text-xl font-bold text-slate-700">
                                {item.targetKmL.toFixed(2)} <span className="text-xs text-slate-400">km/L</span>
                            </p>
                        </div>
                    </div>

                    <div className="flex items-center justify-between text-sm border-t border-slate-100 pt-3">
                        <div className="flex items-center gap-1 text-slate-600">
                            <Fuel className="w-4 h-4" />
                            <span>{item.bahtPerKm} บาท/กม.</span>
                        </div>
                        <div className={`flex items-center gap-1 font-medium ${isPass ? 'text-green-600' : 'text-red-600'}`}>
                            {isPass ? <TrendingUp className="w-4 h-4" /> : <TrendingDown className="w-4 h-4" />}
                            <span>{diff > 0 ? '+' : ''}{diff} ({percentageDiff}%)</span>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            // Calculate Totals
            const totalDistance = data.reduce((acc, curr) => acc + curr.distance, 0);
            const totalFuelCost = data.reduce((acc, curr) => acc + curr.fuelCost, 0);
            const totalFuelLiters = data.reduce((acc, curr) => acc + curr.fuelLiters, 0);
            
            // Adjusted calculation: Total Distance / Total Fuel Liters
            const avgEfficiency = (totalDistance / totalFuelLiters).toFixed(2);

            return (
                <div className="min-h-screen bg-slate-50 font-sans p-6 pb-20">
                    <div className="max-w-7xl mx-auto space-y-8">
                        
                        {/* Header */}
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">P</div>
                                    <h1 className="text-2xl font-bold text-slate-800">รายงานประสิทธิภาพการใช้เชื้อเพลิง</h1>
                                </div>
                                <p className="text-slate-500 text-sm pl-14">บริษัท พัฒนาสิน ไทยเทรดดิ้ง จำกัด | ประจำเดือน: Jan-26</p>
                            </div>
                            <div className="flex gap-3">
                                <div className="text-right hidden md:block">
                                    <p className="text-sm font-semibold text-slate-700">ยอดขายรวม</p>
                                    <p className="text-lg font-bold text-blue-600">11,910,842.86 บาท</p>
                                </div>
                            </div>
                        </div>

                        {/* Key Metrics */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <SummaryCard 
                                title="ระยะทางรวม (กม.)" 
                                value={totalDistance.toLocaleString()} 
                                subtext="ระยะทางวิ่งงานทั้งหมดในเดือนนี้"
                                icon={Truck}
                                colorClass="text-blue-600"
                            />
                            <SummaryCard 
                                title="ค่าใช้จ่ายน้ำมันรวม" 
                                value={`฿${totalFuelCost.toLocaleString()}`} 
                                subtext="ต้นทุนเชื้อเพลิงทั้งหมด"
                                icon={Fuel}
                                colorClass="text-orange-600"
                            />
                            <SummaryCard 
                                title="ประสิทธิภาพเฉลี่ย (km/L)" 
                                value={avgEfficiency} 
                                subtext="ภาพรวมต่ำกว่าเป้าหมายเฉลี่ยเล็กน้อย"
                                icon={TrendingUp}
                                colorClass="text-indigo-600"
                            />
                        </div>

                        {/* Chart Section */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                    <TrendingUp className="w-5 h-5 text-blue-600" />
                                    เปรียบเทียบ เป้าหมาย (Target) vs ทำได้จริง (Actual)
                                </h2>
                                <div className="flex gap-4 text-sm">
                                    <div className="flex items-center gap-2">
                                        <span className="w-3 h-3 bg-blue-500 rounded-full"></span> ทำได้จริง
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <span className="w-3 h-3 bg-slate-300 rounded-full"></span> เป้าหมาย
                                    </div>
                                </div>
                            </div>
                            
                            <div className="h-80 w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={data} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                        <XAxis dataKey="truckName" />
                                        <YAxis label={{ value: 'km/L', angle: -90, position: 'insideLeft' }} />
                                        <Tooltip 
                                            cursor={{fill: '#f8fafc'}}
                                            contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}
                                        />
                                        <Legend />
                                        <Bar name="เป้าหมาย (Target)" dataKey="targetKmL" fill="#cbd5e1" radius={[4, 4, 0, 0]} />
                                        <Bar name="ทำได้จริง (Actual)" dataKey="actualKmL" fill="#3b82f6" radius={[4, 4, 0, 0]}>
                                            {
                                                data.map((entry, index) => (
                                                    <cell key={`cell-${index}`} fill={entry.actualKmL >= entry.targetKmL ? '#22c55e' : '#ef4444'} />
                                                ))
                                            }
                                        </Bar>
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        {/* Driver Performance Grid */}
                        <div>
                            <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <User className="w-5 h-5 text-blue-600" />
                                สรุปผลรายบุคคล (Driver Performance)
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {data.map((item) => (
                                    <DriverCard key={item.id} item={item} />
                                ))}
                            </div>
                        </div>

                        {/* Analysis & Summary */}
                        <div className="bg-blue-900 text-white rounded-xl p-8 shadow-lg">
                            <h2 className="text-xl font-bold mb-6 flex items-center gap-3">
                                <AlertCircle className="w-6 h-6 text-yellow-400" />
                                สรุปพฤติกรรมและการวิเคราะห์ (Analysis)
                            </h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <h3 className="font-semibold text-blue-200 mb-3 border-b border-blue-700 pb-2">ภาพรวมประสิทธิภาพ (Overview)</h3>
                                    <ul className="space-y-3 text-blue-50">
                                        <li className="flex items-start gap-2">
                                            <div className="mt-1.5 w-1.5 h-1.5 rounded-full bg-red-400 flex-shrink-0"></div>
                                            <span>รถจำนวน <strong>4 จาก 5 คัน</strong> มีอัตราการสิ้นเปลืองต่ำกว่าเป้าหมาย (ตกเกณฑ์)</span>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <div className="mt-1.5 w-1.5 h-1.5 rounded-full bg-green-400 flex-shrink-0"></div>
                                            <span><strong>คุณบูรพา (รถทำเงิน)</strong> เป็นผู้ขับขี่เพียงคนเดียวที่ทำยอดได้สูงกว่าเป้าหมาย (+3.97%)</span>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <div className="mt-1.5 w-1.5 h-1.5 rounded-full bg-yellow-400 flex-shrink-0"></div>
                                            <span>ต้นทุนเฉลี่ยอยู่ที่ <strong>3.64 บาท/กม.</strong> ซึ่งสามารถลดลงได้อีกหากปรับปรุงพฤติกรรม</span>
                                        </li>
                                    </ul>
                                </div>

                                <div>
                                    <h3 className="font-semibold text-blue-200 mb-3 border-b border-blue-700 pb-2">ข้อสังเกตและข้อเสนอแนะ (Recommendations)</h3>
                                    <ul className="space-y-3 text-blue-50">
                                        <li className="flex items-start gap-2">
                                            <CheckCircle className="w-5 h-5 text-green-400 flex-shrink-0" />
                                            <div>
                                                <span className="font-bold text-white">รถออมสิน (ไม่ระบุคนขับ):</span> ห่างจากเป้าหมายมากที่สุด (-1.19 km/L) ควรตรวจสอบสภาพเครื่องยนต์ หรือตรวจสอบเส้นทางการวิ่ง
                                            </div>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <CheckCircle className="w-5 h-5 text-yellow-400 flex-shrink-0" />
                                            <div>
                                                <span className="font-bold text-white">รถบุญหนัก & รถนำโชค:</span> ผลงานใกล้เคียงเป้าหมาย (ขาด 0.2-0.6 km/L) แนะนำให้เน้นเรื่องการลดการจอดติดเครื่องยนต์ (Idling) และการใช้เกียร์ให้เหมาะสม
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <a href="index.html" style="position: fixed; bottom: 20px; right: 20px; background-color: #198754; color: white; padding: 10px 20px; text-decoration: none; border-radius: 30px; font-weight: bold; box-shadow: 2px 2px 5px rgba(0,0,0,0.3); z-index: 9999;">
    ⟲ กลับหน้าหลัก
</a>
</body>

</html>
