<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard สรุปการตรวจนับสินค้าคงคลัง - บริษัท พัฒนาสิน (หนองคาย) จำกัด</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #f3f4f6;
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .table-row-hover:hover {
            background-color: #f9fafb;
        }
        .status-shortage {
            color: #ef4444;
            font-weight: 600;
        }
        .status-overage {
            color: #3b82f6;
            font-weight: 600;
        }
        /* Custom scrollbar for table */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <div class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center flex-wrap gap-4">
            <div>
                <h1 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
                    <i class="fa-solid fa-boxes-stacked text-indigo-600"></i>
                    สรุปการตรวจนับสินค้าคงคลัง
                </h1>
                <p class="text-sm text-gray-500 mt-1">บริษัท พัฒนาสิน (หนองคาย) จำกัด | ประจำเดือนมกราคม | กลุ่มสินค้า: เกษตร, ปุ๋ย, PVC, เหล็ก</p>
            </div>
            <div class="flex items-center gap-3">
                <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium">
                    เป้าหมายความแม่นยำ: 95%
                </span>
                <button onclick="window.print()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm transition font-medium flex items-center gap-2">
                    <i class="fa-solid fa-print"></i> พิมพ์รายงาน
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Items -->
            <div class="bg-white rounded-xl p-6 card-shadow border-l-4 border-indigo-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">รายการที่ตรวจนับ</p>
                        <h3 class="text-3xl font-bold text-gray-900 mt-1">487</h3>
                        <p class="text-xs text-gray-400 mt-1">รายการ (SKUs)</p>
                    </div>
                    <div class="p-3 bg-indigo-50 rounded-lg text-indigo-600">
                        <i class="fa-solid fa-list-check text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Accuracy -->
            <div class="bg-white rounded-xl p-6 card-shadow border-l-4 border-yellow-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">ความแม่นยำ (Accuracy)</p>
                        <div class="flex items-end gap-2 mt-1">
                            <h3 class="text-3xl font-bold text-yellow-600">88%</h3>
                            <span class="text-xs text-red-500 font-medium mb-1">(-7% จากเป้า)</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5 mt-2">
                            <div class="bg-yellow-500 h-1.5 rounded-full" style="width: 88%"></div>
                        </div>
                    </div>
                    <div class="p-3 bg-yellow-50 rounded-lg text-yellow-600">
                        <i class="fa-solid fa-bullseye text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Shortage -->
            <div class="bg-white rounded-xl p-6 card-shadow border-l-4 border-red-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">สต๊อกขาด (Shortage)</p>
                        <h3 class="text-2xl font-bold text-red-600 mt-1">-7,699.54</h3>
                        <p class="text-xs text-gray-500 mt-1">บาท (37 รายการ/369 ชิ้น)</p>
                    </div>
                    <div class="p-3 bg-red-50 rounded-lg text-red-600">
                        <i class="fa-solid fa-arrow-trend-down text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Overage -->
            <div class="bg-white rounded-xl p-6 card-shadow border-l-4 border-blue-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">สต๊อกเกิน (Overage)</p>
                        <h3 class="text-2xl font-bold text-blue-600 mt-1">+2,652.53</h3>
                        <p class="text-xs text-gray-500 mt-1">บาท (20 รายการ/207 ชิ้น)</p>
                    </div>
                    <div class="p-3 bg-blue-50 rounded-lg text-blue-600">
                        <i class="fa-solid fa-arrow-trend-up text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis & Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            
            <!-- Analysis Text -->
            <div class="lg:col-span-2 bg-white rounded-xl p-6 card-shadow">
                <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                    <i class="fa-solid fa-magnifying-glass-chart text-indigo-600 mr-2"></i>
                    วิเคราะห์สาเหตุปัญหา (Root Cause Analysis)
                </h3>
                
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                    <h4 class="font-bold text-orange-800 mb-1 flex items-center">
                        <i class="fa-solid fa-triangle-exclamation mr-2"></i> ปัญหาหลัก: สินค้าสลับกัน (Item Swapping)
                    </h4>
                    <p class="text-sm text-orange-700">
                        พบสินค้ารหัสใกล้เคียงกัน หรือสินค้าที่มีลักษณะภายนอกคล้ายคลึงกัน มียอด ขาด/เกิน สวนทางกันอย่างชัดเจน ซึ่งบ่งบอกถึงการหยิบของผิดรายการหรือการติดป้ายชั้นวางผิด
                    </p>
                </div>

                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <div class="min-w-[24px] mt-1 text-center">
                            <span class="bg-gray-200 text-gray-700 text-xs font-bold px-2 py-1 rounded">1</span>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-gray-800">สายเอ็นตัดหญ้า (#60 vs #90)</p>
                            <p class="text-xs text-gray-600">A1-0058 (ขาด -1) และ A1-0061 (เกิน +1) สาเหตุจากบรรจุภัณฑ์เหมือนกัน ต่างกันแค่ขนาด</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="min-w-[24px] mt-1 text-center">
                            <span class="bg-gray-200 text-gray-700 text-xs font-bold px-2 py-1 rounded">2</span>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-gray-800">ใบมีดตัดข้าว (มีฟัน vs ไม่มีฟัน)</p>
                            <p class="text-xs text-gray-600">A1-0030-01 (เกิน +3) และ A1-0030-02 (ขาด -3) สินค้าวางใกล้กันและรูปลักษณ์คล้ายกันมาก</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="min-w-[24px] mt-1 text-center">
                            <span class="bg-gray-200 text-gray-700 text-xs font-bold px-2 py-1 rounded">3</span>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-gray-800">เมล็ดพันธุ์ข้าวโพด (สวีทไวท์ vs เหนียวหวาน)</p>
                            <p class="text-xs text-gray-600">A4-2018 (เกิน +1) และ A4-2020 (ขาด -1) ซองบรรจุอาจมีความคล้ายคลึงกัน</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="min-w-[24px] mt-1 text-center">
                            <span class="bg-gray-200 text-gray-700 text-xs font-bold px-2 py-1 rounded">4</span>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-gray-800">กลุ่มท่อ PVC และข้อต่อ</p>
                            <p class="text-xs text-gray-600">พบรายการ ขาด/เกิน กระจายตัวหลายรายการ คาดว่าเกิดจากการหยิบผิดชั้น (ชั้น 8.5 vs ชั้น 5) หรือขนาดใกล้เคียง (1/2" vs 3/4")</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="bg-white rounded-xl p-6 card-shadow flex flex-col justify-between">
                <div>
                    <h4 class="text-sm font-bold text-gray-600 mb-4 text-center">สัดส่วนผลการนับ (รายการ)</h4>
                    <div class="h-48 flex justify-center">
                        <canvas id="accuracyChart"></canvas>
                    </div>
                </div>
                <div class="mt-6 border-t pt-4">
                    <h4 class="text-sm font-bold text-gray-600 mb-2 text-center">มูลค่าความเสียหายสุทธิ</h4>
                     <div class="text-center">
                         <span class="text-2xl font-bold text-red-500">-5,047.01</span>
                         <span class="text-xs text-gray-400 block">บาท (Net Value)</span>
                     </div>
                </div>
            </div>
        </div>

        <!-- Data Table Section -->
        <div class="bg-white rounded-xl card-shadow overflow-hidden">
            <div class="p-6 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-center gap-4">
                <h3 class="text-lg font-bold text-gray-800">
                    <i class="fa-solid fa-table-list text-indigo-600 mr-2"></i>
                    รายละเอียดรายการที่พบผลต่าง (Diff)
                </h3>
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="ค้นหารหัส หรือ ชื่อสินค้า..." class="pl-10 pr-4 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-64">
                    <i class="fa-solid fa-search absolute left-3 top-2.5 text-gray-400"></i>
                </div>
            </div>
            
            <div class="overflow-x-auto custom-scroll">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-50 text-gray-600 text-sm uppercase font-semibold">
                        <tr>
                            <th class="p-4 border-b">รหัสสินค้า</th>
                            <th class="p-4 border-b">ชื่อสินค้า</th>
                            <th class="p-4 border-b text-center">คลัง</th>
                            <th class="p-4 border-b text-center">หน่วย</th>
                            <th class="p-4 border-b text-right">คงเหลือ(ระบบ)</th>
                            <th class="p-4 border-b text-right">ที่ตรวจนับ</th>
                            <th class="p-4 border-b text-center">สถานะ</th>
                            <th class="p-4 border-b text-right">ผลต่าง</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody" class="text-sm text-gray-700 divide-y divide-gray-100">
                        <!-- Data will be populated by JS -->
                    </tbody>
                </table>
            </div>
            <div class="p-4 bg-gray-50 border-t text-xs text-gray-500 flex justify-between">
                <span>แสดงรายการเฉพาะที่มีผลต่าง (Variance Only)</span>
                <span id="rowCount">0 รายการ</span>
            </div>
        </div>
    </div>

    <!-- Script Section -->
    <script>
        // Data derived from the uploaded image
        const inventoryData = [
            { code: "A1-0058", name: "สายเอ็น #60 (6ม้วน)", warehouse: "B02", unit: "ม้วน", sys: 11, count: 10, status: "ขาด", diff: -1 },
            { code: "A1-0061", name: "สายเอ็น #90 (6ม้วน)", warehouse: "B02", unit: "ม้วน", sys: 8, count: 9, status: "เกิน", diff: 1 },
            { code: "A2-0023-01", name: "ตาข่ายกรองแสง 80%*2*100 ดำ ตราไก่พระอาทิตย์", warehouse: "B02", unit: "เมตร", sys: 188, count: 88, status: "ขาด", diff: -100 },
            { code: "A2-0023-02", name: "ตาข่ายกรองแสง 80%*2*100 เขียว ตราไก่พระอาทิตย์", warehouse: "B02", unit: "เมตร", sys: 134, count: 100, status: "ขาด", diff: -34 },
            { code: "A3-1001", name: "ถาดเพาะชำ 105 หลุม", warehouse: "B02", unit: "ใบ", sys: 299, count: 308, status: "เกิน", diff: 9 },
            { code: "A3-1004", name: "ถาดเพาะชำ 60 หลุม ไม่มีขอบ", warehouse: "B02", unit: "ใบ", sys: 137, count: 132, status: "ขาด", diff: -5 },
            { code: "A3-1007", name: "ถาดโลหะ ใหญ่มีรู", warehouse: "B02", unit: "ใบ", sys: 14, count: 19, status: "เกิน", diff: 5 },
            { code: "A3-1019", name: "ถุงเพาะสีดำ พับข้าง เจาะรู 3\"x6\"", warehouse: "B02", unit: "กิโลกรัม", sys: 15.8, count: 15.1, status: "ขาด", diff: -0.7 },
            { code: "A3-1020", name: "ถุงเพาะสีดำ พับข้าง เจาะรู 4\"x8\"", warehouse: "B02", unit: "กิโลกรัม", sys: 23.5, count: 23.2, status: "ขาด", diff: -0.3 },
            { code: "A3-1021", name: "ถุงเพาะสีดำ พับข้าง เจาะรู 5\"x10\"", warehouse: "B02", unit: "กิโลกรัม", sys: 28.5, count: 28, status: "ขาด", diff: -0.5 },
            { code: "A3-2007", name: "กระถางดำ 6\"", warehouse: "B02", unit: "ใบ", sys: 43, count: 42, status: "ขาด", diff: -1 },
            { code: "A3-3006", name: "บัวรดน้ำสังกะสี เล็ก (5.75ลิตร)", warehouse: "B02", unit: "อัน", sys: 5, count: 6, status: "เกิน", diff: 1 },
            { code: "A5-1001", name: "ถ้วยรุ่งเรือง 1000CC", warehouse: "B02", unit: "ใบ", sys: 323, count: 324, status: "เกิน", diff: 1 },
            { code: "A5-1002", name: "ถ้วยรุ่งเรือง 1500CC", warehouse: "B02", unit: "ใบ", sys: 203, count: 200, status: "ขาด", diff: -3 },
            { code: "A1-0013-02", name: "ใบตัดหญ้า 14\" อัศวินม้าขาว", warehouse: "B02", unit: "ใบ", sys: 6, count: 5, status: "ขาด", diff: -1 },
            { code: "A1-0030-01", name: "ใบตัดข้าว มีฟัน 20\"", warehouse: "B02", unit: "ใบ", sys: 16, count: 19, status: "เกิน", diff: 3 },
            { code: "A1-0030-02", name: "ใบตัดข้าว ไม่มีฟัน 20\"", warehouse: "B02", unit: "ใบ", sys: 18, count: 15, status: "ขาด", diff: -3 },
            { code: "P0-0701", name: "ท่อพีวีซี 1/2\" ชั้น 8.5 ปลายเรียบ ตราเพชร", warehouse: "B02", unit: "เส้น", sys: 170, count: 159, status: "ขาด", diff: -11 },
            { code: "P0-0703", name: "ท่อพีวีซี 3/4\" ชั้น 8.5 ปลายเรียบ ตราเพชร", warehouse: "B02", unit: "เส้น", sys: 47, count: 49, status: "เกิน", diff: 2 },
            { code: "P0-0722", name: "ท่อพีวีซี 4\" ชั้น 5 บานหัว ตราเพชร", warehouse: "B02", unit: "เส้น", sys: 1, count: 2, status: "เกิน", diff: 1 },
            { code: "P0-0723", name: "ท่อพีวีซี 4\" ชั้น 8.5 บานหัว ตราเพชร", warehouse: "B02", unit: "เส้น", sys: 19, count: 18, status: "ขาด", diff: -1 },
            { code: "P0-1322", name: "ท่อพีวีซี 4\" ชั้น 5 บานหัว ตราดาว", warehouse: "B02", unit: "เส้น", sys: 24, count: 25, status: "เกิน", diff: 1 },
            { code: "A6-0003", name: "ปุ๋ยเคมี 46-0-0 กระต่าย (ยูเรีย)", warehouse: "B02", unit: "กิโลกรัม", sys: 924, count: 918, status: "ขาด", diff: -6 },
            { code: "B9-1301", name: "ฉากซีลาย 3/4\" x 2.4เมตร", warehouse: "B02", unit: "เส้น", sys: 0, count: 149, status: "เกิน", diff: 149 },
            { code: "B9-1302", name: "ฉากซีลาย 1\" x 2.4เมตร (50/มัด)", warehouse: "B02", unit: "เส้น", sys: 152, count: 3, status: "ขาด", diff: -149 },
            { code: "B9-1502", name: "ผนังเบา ตัวซี เบอร์24*75 2.4ม.", warehouse: "B02", unit: "เส้น", sys: 90, count: 70, status: "ขาด", diff: -20 },
            { code: "B9-1506", name: "ผนังเบา ตัวยู เบอร์24*75 2.4ม.", warehouse: "B02", unit: "เส้น", sys: 90, count: 110, status: "เกิน", diff: 20 },
            { code: "A4-2018", name: "ข้าวโพดข้าวเหนียว สวีทไวท์ 25 EBS", warehouse: "B02", unit: "ถุง", sys: 8, count: 9, status: "เกิน", diff: 1 },
            { code: "A4-2020", name: "ข้าวโพดข้าวเหนียว เหนียวหวานทับทิม", warehouse: "B02", unit: "ถุง", sys: 2, count: 1, status: "ขาด", diff: -1 },
            { code: "K0-0001", name: "เบทาโกร 841 (ปลานิลพืชชนิดเล็ก)", warehouse: "B02", unit: "กิโลกรัม", sys: 38, count: 40, status: "เกิน", diff: 2 }
        ];

        function renderTable(data) {
            const tbody = document.getElementById('inventoryTableBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-100 hover:bg-gray-50 transition';
                
                // Color coding logic based on grouping in the image (simulated logic for swapping pairs)
                let rowBg = '';
                if(item.diff > 0) rowBg = 'text-blue-600';
                if(item.diff < 0) rowBg = 'text-red-600';

                tr.innerHTML = `
                    <td class="p-4 font-mono text-xs text-gray-500">${item.code}</td>
                    <td class="p-4 font-medium text-gray-800">${item.name}</td>
                    <td class="p-4 text-center text-gray-500">${item.warehouse}</td>
                    <td class="p-4 text-center text-gray-500">${item.unit}</td>
                    <td class="p-4 text-right text-gray-600">${item.sys}</td>
                    <td class="p-4 text-right font-bold text-gray-800">${item.count}</td>
                    <td class="p-4 text-center">
                        <span class="${item.status === 'ขาด' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'} px-2 py-1 rounded text-xs font-bold">
                            ${item.status}
                        </span>
                    </td>
                    <td class="p-4 text-right font-bold ${item.diff < 0 ? 'text-red-600' : 'text-blue-600'}">
                        ${item.diff > 0 ? '+' : ''}${item.diff}
                    </td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('rowCount').innerText = `${data.length} รายการ`;
        }

        // Search Function
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            const term = e.target.value.toLowerCase();
            const filtered = inventoryData.filter(item => 
                item.code.toLowerCase().includes(term) || 
                item.name.toLowerCase().includes(term)
            );
            renderTable(filtered);
        });

        // Charts
        function initCharts() {
            const ctxAcc = document.getElementById('accuracyChart').getContext('2d');
            
            new Chart(ctxAcc, {
                type: 'doughnut',
                data: {
                    labels: ['ถูกต้อง (Match)', 'ไม่ถูกต้อง (Variance)'],
                    datasets: [{
                        data: [430, 57], // From summary image
                        backgroundColor: ['#22c55e', '#ef4444'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: 'Prompt' }
                            }
                        }
                    }
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTable(inventoryData);
            initCharts();
        });

    </script>
    <a href="stockwarehouse.html" style="position: fixed; bottom: 20px; right: 20px; background-color: #0d6efd; color: white; padding: 10px 20px; text-decoration: none; border-radius: 30px; font-weight: bold; box-shadow: 2px 2px 5px rgba(0,0,0,0.3); z-index: 9999;">
    หน้าถัดไป (Stock Warehouse) ➜
</a>
</body>

</html>
